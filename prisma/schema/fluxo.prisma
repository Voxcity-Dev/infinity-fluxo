// FLUXO

enum FluxoConfiguracaoChave {
  // Mensagem enviada quando o bot direciona o atendimento para fila ou usuário
  ENVIA_MENSAGEM

  // Mensagem de feedback caso a resposta do cliente não seja esperada
  MENSAGEM_INVALIDA

  // Tempo máximo (em minutos) de espera por uma resposta antes de tomar ação
  TEMPO_MAXIMO

  // Fila padrão para encaminhamento
  FILA_PADRAO

  // Usuário padrão para encaminhamento
  USUARIO_PADRAO

  // Número máximo de tentativas do bot para perguntar/resposta
  MAXIMO_TENTATIVAS

  // Política de distribuição automática de atendimento
  DISTRIBUICAO_AUTOMATICA // valores possíveis: NONE, RANDOM, BALANCED

  // Encerrar atendimento quando alguma condição for satisfeita
  ENCERRAR_FLUXO_CONDIÇÃO

  // Mensagem de finalização do fluxo
  MENSAGEM_FINALIZACAO

  // Expiração na Triagem
  EXPIRACAO_TRIAGEM_HABILITADA   // "true" | "false"
  EXPIRACAO_TRIAGEM_MINUTOS      // "30"
  EXPIRACAO_TRIAGEM_MENSAGEM     // "Seu atendimento expirou..."

  // NPS expiração foi movido para o CRUD de NPS (infinity-fluxo/src/nps)
}

model FluxoConfiguracao {
  id         String                 @id @default(uuid()) @db.Uuid
  tenant_id  String                 @db.Uuid
  fluxo_id   String                 @db.Uuid
  chave      FluxoConfiguracaoChave
  valor      String                 @db.Text
  created_at DateTime               @default(now()) @db.Timestamp(6)
  updated_at DateTime               @updatedAt @db.Timestamp(6)

  // Relação
  fluxo Fluxo @relation(fields: [fluxo_id], references: [id])

  @@unique([fluxo_id, chave])
  @@index([tenant_id, fluxo_id, chave])
  @@map("fluxo_configuracoes")
}

model Fluxo {
  id            String              @id @default(uuid()) @db.Uuid
  tenant_id     String              @db.Uuid
  nome          String              @db.VarChar(50)
  descricao     String?             @db.Text
  etapas        Etapas[]
  configuracoes FluxoConfiguracao[]
  is_deleted    Boolean             @default(false)
  created_at    DateTime            @default(now()) @db.Timestamp(6)
  updated_at    DateTime            @updatedAt @db.Timestamp(6)

  @@index([tenant_id, nome])
  @@map("fluxos")
}
